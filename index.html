<!-- index.html
  Código-base A-Frame + AR.js para o protótipo "Super Trunfo" em RA (marcadores).
  Instruções rápidas:
  - Substitua os arquivos pattern (pattern-back.patt, pattern-releitura.patt) pelos seus gerados.
  - Substitua model.gltf e releitura.gltf pelos seus modelos (ou use primitivas <a-box>/<a-plane>).
  - Rode num servidor local e acesse pelo celular (mesma rede Wi-Fi).
-->

<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <title>Protótipo RA - Super Trunfo (MHJS)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- A-Frame -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <!-- AR.js (A-Frame build) -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        body {
            margin: 0;
            font-family: sans-serif;
        }

        #overlay {
            position: fixed;
            left: 8px;
            top: 8px;
            right: 8px;
            z-index: 20;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            padding: 12px 32px 12px 12px;
            /* espaço maior para o botão de fechar */
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
        }

        #closeOverlay {
            position: absolute;
            right: 6px;
            top: 6px;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        #infoButton {
            position: fixed;
            right: 8px;
            top: 8px;
            z-index: 10;
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            cursor: pointer;
        }

        #infoButton:hover {
            background: rgba(0, 0, 0, 0.75);
        }
    </style>
</head>

<body>
    <!-- Ícone de informação para reabrir o overlay -->
    <div id="infoButton">i</div>

    <!-- Overlay -->
    <div id="overlay">
        <button id="closeOverlay">✕</button>
        <strong>Protótipo RA — Super Trunfo (MHJS)</strong><br>
        Aponte a câmera para o marcador da carta <em>(frente)</em> para ver a releitura em RA.<br>
        Aponte para o marcador <em>(verso)</em> para ativar "sorte ou revés".<br>
    </div>

    <!-- A-Frame scene com AR.js -->
    <!-- MARCADOR: Verso da carta (SORTE / REVÉS / ALEATORIEDADE) -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">

        <!-- ASSETS (mesmo que vazio, é recomendado manter) -->
        <a-assets></a-assets>

        <!-- MARCADOR: Verso da carta -->
        <a-marker type="pattern" url="pattern-back.patt" id="marker-verso">

            <!-- Painel que mostra o resultado -->
            <a-plane id="sorte-placa" position="0 0 0.1" rotation="-90 0 0" width="1" height="0.6" color="#222"
                visible="false">

                <a-text id="sorte-text" value="" align="center" position="0 0 0.01" width="1.8" wrap-count="30">
                </a-text>

            </a-plane>

        </a-marker>

        <!-- CAMERA (necessária para AR funcionar) -->
        <a-entity camera></a-entity>

    </a-scene>

    <!-- Lógica JS simples para controlar visibilidade e eventos -->
    <script>
        /* ============================================================
           OVERLAY (abrir / fechar)
        ============================================================ */
        const overlay = document.getElementById('overlay');
        const closeBtn = document.getElementById('closeOverlay');
        const infoButton = document.getElementById('infoButton');

        // fechar overlay
        closeBtn.addEventListener('click', () => {
            overlay.style.display = 'none';
            infoButton.style.display = 'flex';
        });

        // abrir overlay
        infoButton.addEventListener('click', () => {
            overlay.style.display = 'block';
            infoButton.style.display = 'none';
        });

        // estado inicial
        overlay.style.display = 'block';
        infoButton.style.display = 'none';


        /* ============================================================
           MARCADORES
        ============================================================ */
        const markerFrente = document.querySelector('#marker-frente');
        const markerVerso = document.querySelector('#marker-verso');
        const releituraEntity = document.querySelector('#releitura-entity');
        const sortePlaca = document.querySelector('#sorte-placa');
        const sorteTexto = document.querySelector('#sorte-text');


        /* ============================================================
           FUNÇÃO 1 — RELEITURA (marcador da frente)
        ============================================================ */

        // quando aparece
        markerFrente.addEventListener('markerFound', () => {
            releituraEntity.setAttribute('visible', 'true');
            releituraEntity.setAttribute(
                'animation',
                'property: rotation; to: 0 540 0; loop: true; dur: 10000; easing: linear'
            );
        });

        // quando some
        markerFrente.addEventListener('markerLost', () => {
            releituraEntity.setAttribute('visible', 'false');
            releituraEntity.removeAttribute('animation');
        });


        /* ============================================================
           FUNÇÃO 2 — SORTE / REVÉS / ALEATORIEDADE (marcador verso)
        ============================================================ */

        // Lista completa das ações possíveis
        const acoes = [
            // SORTE
            "SORTE!\nVocê ganhou uma carta extra do topo da pilha do oponente.",
            "SORTE!\nVocê ganhou uma carta extra e o oponente deve reembaralhar a pilha.",

            // REVÉS
            "REVÉS!\nEmpate Forçado: as cartas vão para o monte central.",
            "REVÉS!\nAtributo Proibido: você não pode repetir o atributo vencedor na próxima rodada.",

            // ALEATORIEDADE
            "ALEATORIEDADE!\nTroca Aleatória: você troca uma carta aleatória com o oponente."
        ];

        // escolhe 1 ação aleatória
        function escolherAcao() {
            const i = Math.floor(Math.random() * acoes.length);
            return acoes[i];
        }

        // quando o marcador verso aparece
        markerVerso.addEventListener('markerFound', () => {
            const resultado = escolherAcao();
            sorteTexto.setAttribute('value', resultado);
            sortePlaca.setAttribute('visible', 'true');

            // animação de destaque
            sortePlaca.setAttribute(
                'animation',
                'property: scale; to: 1.05 1.05 1; dur: 200; dir: alternate; loop: 2'
            );
        });

        // quando o marcador verso some
        markerVerso.addEventListener('markerLost', () => {
            sortePlaca.setAttribute('visible', 'false');
            sortePlaca.removeAttribute('animation');
        });
    </script>

</body>

</html>